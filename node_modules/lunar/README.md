# Lunar v2

> é«˜æ€§èƒ½ã€å…¬å†œå†äº’è½¬ + æ ‡å‡†å†œå†æ–‡æ¡ˆè¾“å‡ºåº“ã€‚è¦†ç›– `1890-2100` å¹´ï¼Œé¢å‘ç°ä»£ TypeScript / JavaScript ç”Ÿæ€ã€‚

## Features
- âœ… **å‡†ç¡®äº’è½¬**ï¼šå†…ç½®å®˜æ–¹å¹´è¡¨ï¼Œ`toLunar` / `toGregorian` å…¬å†œå†äº’è½¬æ”¯æŒé—°æœˆä¸è¾¹ç•Œæ—¥æœŸã€‚
- ğŸš€ **è·¨å¹³å°çº¯å‡½æ•°**ï¼šæ— å¤–éƒ¨ä¾èµ–ï¼ŒNode.jsã€æµè§ˆå™¨ã€Edge Runtimeã€Web Worker å‡å¯ä½¿ç”¨ã€‚
- ğŸ§± **ä¸¥æ ¼æ•°æ®æ¨¡å‹**ï¼š`LunarDate` ä¸å¯å˜ã€å¯åºåˆ—åŒ–ï¼Œä¾¿äºç¼“å­˜å’ŒæŒä¹…åŒ–ã€‚
- âœ¨ **æ ‡å‡†æ–‡æ¡ˆ**ï¼š`formatLunar`/`formatLunarParts` ç›´æ¥è¾“å‡ºâ€œå†œå†ç”²è¾°å¹´æ­£æœˆåˆä¸€â€ä¸€ç±»å­—ç¬¦ä¸²ï¼Œå¯é€‰å¸¦ç”Ÿè‚–ã€å¤©å¹²åœ°æ”¯ã€‚
- ğŸ§ª **TDD ä¿éšœ**ï¼šVitest + é»„é‡‘æ ·æœ¬å›å½’ï¼Œç¡®ä¿ round-trip ä¸€è‡´æ€§ã€‚

æ›´å¤šé‡Œç¨‹ç¢‘ä¸è§„åˆ’å‚è§ [`docs/v2-plan.md`](./docs/v2-plan.md)ã€‚

---

## Installation
```bash
npm install lunar
# æˆ– yarn add lunar
# æˆ– pnpm add lunar
```

å…¼å®¹ Node.js `>= 16.20` ä»¥åŠä»»æ„ ES2020+ ç¯å¢ƒã€‚å»ºè®®ä½¿ç”¨ Node.js 22+ è¿›è¡Œå¼€å‘ä»¥è·å¾—æ›´å¿«çš„æ„å»ºå’Œç±»å‹æ£€æŸ¥ä½“éªŒã€‚

---

## Quick Start
```ts
import { toLunar, toGregorian, formatLunar, createLunarDate } from 'lunar';

// å…¬å† -> å†œå†
const { lunar, metadata } = toLunar(new Date('2024-02-10T00:00:00+08:00'));
console.log(formatLunar(lunar)); // å†œå†ç”²è¾°å¹´æ­£æœˆåˆä¸€
console.log(metadata.timezone);  // Asia/Shanghaiï¼ˆé»˜è®¤ï¼‰

// å†œå† -> å…¬å†
const festival = createLunarDate({ year: 2025, month: 5, day: 5 });
const { date } = toGregorian(festival); // è¿”å› UTC Date å¯¹è±¡

// è‡ªå®šä¹‰æ—¶åŒºï¼ˆä¾‹ï¼šæœåŠ¡å™¨å…¨éƒ¨å­˜ UTCï¼‰
const timezone = 'UTC';
const utcResult = toLunar(new Date('2024-02-09T16:00:00Z'), { timezone });
const roundTrip = toGregorian(utcResult.lunar, { timezone });
```

---

## API Reference

### `toLunar(input, options?)`
- **input** (`GregorianDateInput`): `Date`ã€UTC æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰æˆ– `{ year, month, day }` å¯¹è±¡ã€‚æœˆä»½ä¸º 1-12ã€‚
- **options.timezone?** (`string`): IANA æ—¶åŒº IDï¼Œå†³å®šå¦‚ä½•ç†è§£è¾“å…¥çš„â€œæœ¬åœ°æ—¥æœŸâ€ã€‚é»˜è®¤ `Asia/Shanghai`ã€‚
- **returns**:  
  ```ts
  interface ToLunarResult {
    lunar: LunarDate;      // å½’ä¸€åŒ–å†œå†æ—¥æœŸ
    source: Date;          // å½’ä¸€åŒ–åçš„å…¬å† Dateï¼ˆUTCï¼‰
    metadata: { timezone: string };
  }
  ```

### `toGregorian(input, options?)`
- **input** (`LunarDateInput`): `LunarDate`ã€`{ year, month, day, isLeapMonth? }` æˆ– `[year, month, day, isLeapMonth?]`ã€‚
- **options.timezone?**ï¼šä¸ `toLunar` ä¸€è‡´ï¼Œç”¨äºå°†ç»“æœå¯¹é½åˆ°æŒ‡å®šæ—¶åŒºçš„é›¶ç‚¹ã€‚
- **returns**:  
  ```ts
  interface ToGregorianResult {
    date: Date;            // UTC Dateï¼Œè¡¨ç¤ºå½“åœ°é›¶ç‚¹
    source: LunarDate;     // å½’ä¸€åŒ–å†œå†è¾“å…¥
    metadata: { timezone: string };
  }
  ```

### `createLunarDate(input)`
å°†ç”¨æˆ·è¾“å…¥å½’ä¸€åŒ–ä¸ºä¸å¯å˜ `LunarDate`ã€‚ä¼šæ ¡éªŒå¹´ä»½ï¼ˆ`1890-2100`ï¼‰ã€æœˆä»½ï¼ˆ1-12ï¼‰å’Œæ—¥æœŸï¼ˆ1-30ï¼‰ï¼Œéæ³•å€¼ä¼šæŠ›å‡º `InvalidLunarDateError`ã€‚

### `formatLunar(input, options?)`
æŠŠå†œå†æ—¥æœŸæ¸²æŸ“ä¸ºæ ‡å‡†å­—ç¬¦ä¸²ï¼Œé»˜è®¤è¾“å‡º `å†œå†ç”²è¾°å¹´æ­£æœˆåˆä¸€`ã€‚

```ts
formatLunar(lunar, {
  zodiac: true,        // å†œå†ç”²è¾°å¹´ï¼ˆé¾™ï¼‰æ­£æœˆåˆä¸€
  prefix: 'Lunar ',    // è‡ªå®šä¹‰å‰ç¼€ï¼›ä¼  false åˆ™ä¸è¾“å‡ºâ€œå†œå†â€
  stemBranch: false,   // ç¦ç”¨å¤©å¹²åœ°æ”¯ï¼Œç”¨æ•°å­—å¹´ä»½
  leapMarker: 'é—°æœˆ'   // å†œå†é—°æœˆå‰ç¼€
});
```

### `formatLunarParts(input, options?)`
ä¸ `formatLunar` ç›¸åŒï¼Œä½†è¿”å›ç»“æ„åŒ–ç‰‡æ®µï¼Œå¯ç”¨äºè‡ªå®šä¹‰æ¸²æŸ“æˆ–æœ¬åœ°åŒ–ï¼š
```ts
[
  { type: 'prefix', value: 'å†œå†' },
  { type: 'yearStem', value: 'ç”²' },
  { type: 'yearBranch', value: 'è¾°' },
  { type: 'literal', value: 'å¹´' },
  { type: 'month', value: 'æ­£æœˆ' },
  { type: 'day', value: 'åˆä¸€' }
]
```

---

## Inputs & Outputs

| åç§° | è¯´æ˜ | å–å€¼/ç»“æ„ |
| --- | --- | --- |
| `LunarDate` | ä¸å¯å˜å†œå†å¯¹è±¡ | `{ year: number; month: 1-12; day: 1-30; isLeapMonth: boolean }` |
| `LunarDateInput` | ä»»æ„å¯è¢«å½’ä¸€åŒ–çš„å†œå†è¾“å…¥ | `LunarDate`ã€å¯¹è±¡æˆ–å…ƒç»„ `[year, month, day, isLeapMonth?]` |
| `GregorianDateInput` | å…¬å†è¾“å…¥ | `Date`ã€UTC æ¯«ç§’æ•°æˆ– `{ year, month, day }`ï¼ˆ1 åŸºæœˆï¼‰ |
| `ConversionOptions` | æ—¶åŒºé…ç½® | `{ timezone?: string }`ï¼Œé»˜è®¤ `Asia/Shanghai` |
| `FormatLunarOptions` | æ–‡æ¡ˆæ§åˆ¶ | `prefix`, `stemBranch`, `zodiac`, `leapMarker`, `style`, `locale`ï¼ˆè¯¦è§ `src/types.ts`ï¼‰ |

**å¹´ä»½èŒƒå›´**ï¼š`1890-2100`ã€‚è¶…å‡ºèŒƒå›´ä¼šæŠ›å‡º `InvalidGregorianDateError` æˆ– `InvalidLunarDateError`ã€‚  
**æ—¶åŒºè¡Œä¸º**ï¼šè¾“å…¥å…¬å†æ—¶å…ˆæŒ‰æŒ‡å®šæ—¶åŒºè½¬æ¢ä¸ºå½“åœ°æ—¥æœŸï¼Œå†æ˜ å°„åˆ°å†œå†ï¼›åå‘è½¬æ¢äº¦ç„¶ï¼Œç¡®ä¿ round-trip ä¸å—æœåŠ¡å™¨/å®¢æˆ·ç«¯æœ¬åœ°æ—¶é—´å½±å“ã€‚

---

## Formatting Guide

`FormatLunarOptions` å…³é”®å­—æ®µï¼š
- `prefix` (`boolean | string`): æ§åˆ¶â€œå†œå†â€å‰ç¼€ï¼Œé»˜è®¤ `true`ã€‚ä¼ å­—ç¬¦ä¸²ä»£è¡¨è‡ªå®šä¹‰å‰ç¼€ï¼Œä¼  `false` å…³é—­ã€‚
- `stemBranch` (`boolean | 'year' | 'all'`): æ˜¯å¦è¾“å‡ºå¤©å¹²åœ°æ”¯ã€‚é»˜è®¤ `true`ï¼ˆä»…å¹´å¹²æ”¯ï¼‰ã€‚è®¾ä¸º `false` æ—¶ä½¿ç”¨æ•°å­—å¹´ä»½ã€‚
- `zodiac` (`boolean`): æ˜¯å¦åœ¨å¹´ä»½åé™„åŠ  `ï¼ˆé¾™ï¼‰` ç­‰ç”Ÿè‚–ä¿¡æ¯ã€‚
- `leapMarker` (`string`): é—°æœˆå‰ç¼€ï¼Œé»˜è®¤ `é—°`ï¼ˆä¾‹å¦‚â€œé—°å…«æœˆâ€ï¼‰ã€‚
- `style` (`'long' | 'short'`): æœˆä»½/æ—¥æœŸæ–‡æ¡ˆé£æ ¼ï¼Œå½“å‰ long/short è¾“å‡ºä¸€è‡´ï¼Œæœªæ¥å¯æ‰©å±•ä¸ºâ€œæ­£/åˆä¸€â€æˆ–â€œæ­£1/åˆ1â€ã€‚
- `locale` (`string`): é¢„ç•™å¤šè¯­è¨€æ”¯æŒï¼Œç°é˜¶æ®µä»… `zh-CN`ã€‚

---

## Testing & Development
```bash
# è¿è¡Œ Lint
npm run lint

# è¿è¡Œæµ‹è¯•
npm run test

# æ„å»ºäº§ç‰©ï¼ˆESM + CJS + d.tsï¼‰
npm run build
```

å¼€å‘è§„èŒƒä¸ TDD æµç¨‹è¯·å‚è€ƒ [`docs/v2-plan.md`](./docs/v2-plan.md) å’Œ `CONTRIBUTING` çº¦å®šï¼ˆè‹¥å­˜åœ¨ï¼‰ã€‚

---

## FAQ
**Q: å¯ä»¥æ‰©å±•åˆ° 1890 å¹´ä»¥å‰æˆ– 2100 å¹´ä»¥åå—ï¼Ÿ**  
A: å½“å‰æ•°æ®è¡¨ä»…è¦†ç›– `1890-2100`ã€‚æ‰©å±•èŒƒå›´éœ€è¦å®˜æ–¹å¹´è¡¨æˆ–æƒå¨èµ„æ–™ï¼Œè§„åˆ’è¯·è§ v2 è®¡åˆ’ã€‚

**Q: å¦‚ä½•è¾“å‡ºèŠ‚æ°”ã€ä¼ ç»ŸèŠ‚æ—¥ï¼Ÿ**  
A: v2 æš‚æœªå†…å»ºï¼Œå¯åˆ©ç”¨ `LunarDate` + è‡ªå®šä¹‰æ•°æ®æºç»„åˆã€‚`formatLunarParts` é¢„ç•™äº†æŒ‚è½½ç‚¹ï¼Œåç»­ç‰ˆæœ¬ä¼šè¡¥å……ã€‚

**Q: æµè§ˆå™¨ä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿ**  
A: åŒ…ä¸ºçº¯ TypeScript è¾“å‡ºï¼Œé»˜è®¤æä¾› ESM/CJSã€‚é€šè¿‡ bundlerï¼ˆViteã€Webpackã€Rollupï¼‰æˆ–ç›´æ¥ `import` å³å¯ã€‚

---

## License
[MIT](./LICENSE)
