<!--pages/timer/timer.wxml-->
<view class="flex-col page">
  <view class="flex-col section">
    <view class="flex-col self-stretch">
      <text class="self-center text_2 mt-17">知道有念，知道无念，知道就好</text>
    </view>
    <view class="mt-34 flex-col items-center self-center section_2">
      <!-- 进度圈容器 -->
      <view class="progress-circle-container">
        <!-- 背景圆环 -->
        <view class="progress-circle-bg"></view>
        <!-- 径向进度条 - 使用两个半圆实现 -->
        <view class="progress-circle-fill">
          <view class="progress-circle-half progress-circle-left" style="transform: rotate({{progressAngleLeft}}deg);"></view>
          <view class="progress-circle-half progress-circle-right" style="transform: rotate({{progressAngleRight}}deg);"></view>
        </view>
        <!-- 时间显示 -->
        <view class="time-display">
          <text class="text_3">{{displayTime}}</text>
          <text class="mt-8 font text_4">{{isCountdown ? '倒计时' : '正计时'}}</text>
        </view>
      </view>
    </view>
    <!-- 计时器控制按钮 -->
    <view class="timer-button-container">
      
      <!-- 重置按钮 - 始终显示在左侧 -->
      <view class="weui-btn-circle reset-btn" bindtap="resetTimer" wx:if="{{showResetButton}}">
        <image class="reset-btn-icon" src="{{resetIcon}}" />
        <text class="reset-btn-text">重置</text>
      </view>
      
      <!-- 主控制按钮 - 开始和暂停按钮在同一位置切换 -->
      <view class="weui-btn-circle main-btn primary" bindtap="startTimer" wx:if="{{showStartButton}}">
        <image class="main-btn-icon" src="{{startIcon}}" />
        <text class="main-btn-text">开始</text>
      </view>
      
      <view class="weui-btn-circle pause-btn primary" bindtap="pauseTimer" wx:if="{{showPauseButton}}">
        <image class="pause-btn-icon" src="{{pauseIcon}}" />
        <text class="pause-btn-text">暂停</text>
      </view>
      
      <!-- 停止按钮 - 使用占位方式确保布局对称 -->
      <view class="stop-btn-wrapper">
        <view class="weui-btn-circle stop-btn warn-btn" bindtap="stopTimer" wx:if="{{showStopButton}}">
          <image class="stop-btn-icon" src="{{stopIcon}}" />
          <text class="stop-btn-text">停止</text>
        </view>
        <!-- 隐藏时的占位元素 -->
        <view class="stop-btn-placeholder" wx:if="{{!showStopButton}}"></view>
      </view>
      
    </view>
    <view class="mt-34 flex-col self-stretch group_2">
      <view class="flex-col section_3">
        <view class="flex-row justify-between items-center group_3">
          <view class="flex-row items-center">
            <image
              class="shrink-0 image_4"
              src="https://codefun-proj-user-res-1256085488.cos.ap-guangzhou.myqcloud.com/6970dd1431bc27f41b3ed961/6970dd614bd4760011a78d92/b83eddffb728b6c458e2ecfe6b488e84.png"
            />
            <text class="font ml-13">{{isCountdown ? '倒计时' : '正计时'}}模式</text>
          </view>
          <switch checked="{{isCountdown}}" bindchange="toggleMode" />
        </view>
        <view class="flex-row justify-between items-center section_4" bindtap="showTimePicker">
          <view class="flex-col items-start">
            <text class="font_2 text_5 text_6">时长</text>
            <text class="mt-8 font text_7">{{durationText}}</text>
          </view>
          <image
            class="image_6"
            src="https://ide.code.fun/api/image?token=697369fc4bd4760011a7c18b&name=5c5c537b9d82bae773523227df5301eb.png"
          />
        </view>
      </view>
      <view class="mt-12 flex-row justify-between items-center section_5">
        <view class="flex-row items-center">
          <image
            class="image_4"
            src="https://codefun-proj-user-res-1256085488.cos.ap-guangzhou.myqcloud.com/6970dd1431bc27f41b3ed961/6970dd614bd4760011a78d92/e990152662dbbb2d55be7734e33ab353.png"
          />
          <view class="flex-col items-center ml-13">
            <text class="font_2 text_5 text_8">背景音乐</text>
            <text class="font mt-7">无音乐</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 时长选择器模态框 -->
  <view wx:if="{{showTimePicker}}" class="time-picker-modal">
    <view class="time-picker-overlay" bindtap="hideTimePicker"></view>
    <view class="time-picker-content">
      <view class="time-picker-header">
        <text class="time-picker-title">选择时长</text>
        <view class="time-picker-close" bindtap="hideTimePicker">✕</view>
      </view>
      <view class="time-picker-options">
        <view 
          wx:for="{{timeOptions}}" 
          wx:key="value"
          class="time-option {{item.value === duration ? 'selected' : ''}}"
          bindtap="selectDuration"
          data-value="{{item.value}}"
        >
          <text class="time-option-text">{{item.text}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 自定义时长弹窗 -->
  <view wx:if="{{showCustomTimePicker}}" class="custom-time-modal">
    <view class="custom-time-overlay" bindtap="hideCustomTimePicker"></view>
    <view class="custom-time-content">
      <view class="custom-time-header">
        <text class="custom-time-title">自定义时长</text>
        <view class="custom-time-close" bindtap="hideCustomTimePicker">✕</view>
      </view>
      <view class="custom-time-body">
        <view class="custom-time-input-container">
          <input 
            class="custom-time-input" 
            type="number" 
            placeholder="请输入"
            bindinput="onCustomTimeInput"
            value="{{customTimeInput}}"
            maxlength="3"
          />
          <text class="custom-time-unit">分钟</text>
        </view>
        <view class="custom-time-validation">
          <text wx:if="{{customTimeInput && !isValidCustomTime}}" class="validation-error">
            时长必须在1-180分钟之间
          </text>
        </view>
      </view>
      <view class="custom-time-footer">
        <button 
          class="custom-time-cancel-btn" 
          bindtap="hideCustomTimePicker"
        >取消</button>
        <button 
          class="custom-time-confirm-btn {{isValidCustomTime ? 'active' : 'disabled'}}" 
          bindtap="confirmCustomTime"
          disabled="{{!isValidCustomTime}}"
        >确定</button>
      </view>
    </view>
  </view>
</view>