<!--pages/history/history.wxml-->
<view class="flex-col page">
  <!-- 页面头部 -->
  <view class="flex-col section">
    <view class="flex-row justify-between items-center">
      <view class="flex-row items-center">
        <image class="back-icon" src="/images/icons/left.png" bindtap="goBack" />
        <text class="page-title">打卡历史</text>
      </view>
      <text class="stats-text">共{{totalDays}}天 {{totalCount}}次</text>
    </view>
    
    <!-- 统计卡片 -->
    <view class="stats-cards">
      <view class="stat-card">
        <text class="stat-number">{{currentStreak}}</text>
        <text class="stat-label">当前连续</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{longestStreak}}</text>
        <text class="stat-label">最长连续</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{monthlyCount}}</text>
        <text class="stat-label">本月次数</text>
      </view>
    </view>
  </view>
  
  <!-- 历史记录列表 -->
  <scroll-view class="history-list" scroll-y>
    <view class="history-item" wx:for="{{historyList}}" wx:key="date">
      <view class="date-header">
        <text class="date-text">{{item.date}}</text>
        <text class="count-badge">{{item.count}}次打卡</text>
      </view>
      
      <view class="record-item" wx:for="{{item.records}}" wx:for-item="record" wx:key="timestamp">
        <view class="record-content">
          <view class="record-header">
            <text class="record-time">{{record.time}}</text>
            <view class="record-meta">
              <text class="duration-text">{{record.duration}}</text>
              <view class="rating-stars">
                <image 
                  class="star-icon {{star.active ? 'active' : ''}}"
                  src="/images/icons/{{star.active ? 'star-active' : 'star'}}.png"
                  wx:for="{{record.stars}}"
                  wx:for-item="star"
                  wx:key="index"
                />
              </view>
            </view>
          </view>
          
          <view class="record-details" wx:if="{{record.textCount > 0}}">
            <text class="text-count">记录{{record.textCount}}条</text>
            <text class="text-preview" wx:if="{{record.textPreview}}">{{record.textPreview}}</text>
          </view>
        </view>
      </view>
    </view>
    
    <view class="empty-state" wx:if="{{historyList.length === 0}}">
      <image class="empty-icon" src="/images/icons/recorded.png" />
      <text class="empty-text">暂无打卡记录</text>
      <text class="empty-subtext">开始静坐打卡，记录你的修行历程</text>
    </view>
  </scroll-view>
</view>